<!DOCTYPE html>
<html>
<head>
    <title>Authentication Check Debug</title>
</head>
<body>
    <h1>Authentication Detection Test</h1>
    
    <div id="debug-info"></div>
    
    <script>
        function runAuthCheck() {
            const debugDiv = document.getElementById('debug-info');
            let html = '<h3>Debug Information:</h3>';
            
            // Check 1: Body class
            const hasAuthClass = document.body.classList.contains('authenticated');
            html += `<p><strong>Body class 'authenticated':</strong> ${hasAuthClass}</p>`;
            
            // Check 2: Meta tag
            const metaTag = document.querySelector('meta[name="user-authenticated"]');
            const metaContent = metaTag ? metaTag.content : 'not found';
            html += `<p><strong>Meta tag user-authenticated:</strong> ${metaContent}</p>`;
            
            // Check 3: CSRF token
            const csrfMeta = document.querySelector('meta[name="csrf-token"]');
            const csrfContent = csrfMeta ? csrfMeta.content : 'not found';
            html += `<p><strong>CSRF token available:</strong> ${csrfContent !== 'not found' ? 'Yes' : 'No'}</p>`;
            
            // Check 4: FCM Manager availability
            html += `<p><strong>FCM Manager available:</strong> ${typeof window.fcmManager !== 'undefined'}</p>`;
            
            // Check 5: Notification permission handler initialization
            html += `<p><strong>Notification Permission Handler:</strong> ${typeof window.notificationPermissionHandler !== 'undefined'}</p>`;
            
            // Check 6: Current authentication status (combined check)
            const isAuthenticated = hasAuthClass || metaContent === 'true';
            html += `<p><strong>Final authentication status:</strong> ${isAuthenticated}</p>`;
            
            // Check 7: Current URL
            html += `<p><strong>Current URL:</strong> ${window.location.href}</p>`;
            
            // Check 8: Test FCM Manager initialization
            html += '<h4>FCM Manager Test:</h4>';
            if (window.fcmManager) {
                html += `<p>FCM Manager exists: Yes</p>`;
                html += `<p>Is initialized: ${window.fcmManager.isInitialized || false}</p>`;
                html += `<p>Is supported: ${window.fcmManager.isSupported || false}</p>`;
                html += `<p>Current token: ${window.fcmManager.currentToken ? 'exists' : 'none'}</p>`;
            } else {
                html += '<p>FCM Manager: Not loaded</p>';
            }
            
            debugDiv.innerHTML = html;
        }
        
        // Run check when page loads
        document.addEventListener('DOMContentLoaded', runAuthCheck);
        
        // Also run after a delay in case scripts load asynchronously
        setTimeout(runAuthCheck, 2000);
    </script>
</body>
</html>